

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://gitee.com/gentlecp/ImgUrl/raw/master/20210416092821.png">
  <link rel="icon" href="https://gitee.com/gentlecp/ImgUrl/raw/master/20210416092821.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  
    <meta name="description" content="è®°å½•æˆ‘çš„å­¦ä¹ å’Œç”Ÿæ´»">
  
  <meta name="author" content="GentleCP">
  <meta name="keywords" content="">
  
  <title>ã€angr_ctfã€‘äºŒè¿›åˆ¶åˆ†æå·¥å…·angrä½¿ç”¨ä¸ç»ƒä¹ -Part Iï¼ˆåŸºç¡€ç¯‡ï¼‰ - æ±‚ç´¢</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      
        
          
        
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/themes/prism.min.css" />
      
      
        <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/line-numbers/prism-line-numbers.min.css" />
      
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"blog.gentlecp.com","root":"/","version":"1.8.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":"e327374203a31813ad9ef3899d6f3eb5","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="æ±‚ç´¢" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>æ±‚ç´¢|CP</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210430161149.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="ã€angr_ctfã€‘äºŒè¿›åˆ¶åˆ†æå·¥å…·angrä½¿ç”¨ä¸ç»ƒä¹ -Part Iï¼ˆåŸºç¡€ç¯‡ï¼‰">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      GentleCP
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-30 14:59" pubdate>
        2021å¹´4æœˆ30æ—¥ ä¸‹åˆ
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      100
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ã€angr_ctfã€‘äºŒè¿›åˆ¶åˆ†æå·¥å…·angrä½¿ç”¨ä¸ç»ƒä¹ -Part Iï¼ˆåŸºç¡€ç¯‡ï¼‰</h1>
            
            <div class="markdown-body">
              <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ¬æ–‡è®°å½•ä¸€ä¸‹å­¦ä¹ ä½¿ç”¨<code>angr</code>è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ï¼Œä¸»è¦æ˜¯åŸºäº<code>Github</code>ä¸Š çš„å¼€æºé¡¹ç›®<a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf">jakespringer/angr_ctf</a><sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="jakespringer/angr_ctf (github.com)
">[3]</span></a></sup>ï¼Œè¯¥é¡¹ç›®é€šè¿‡angræ¥è§£å†³ä¸€äº›ctfé¢˜ï¼Œå¸®åŠ©åˆå­¦è€…ä¸€æ­¥æ­¥ç†Ÿæ‚‰<code>angr</code>çš„ä½¿ç”¨ã€‚ç›¸å…³çš„å‚è€ƒèµ„æ–™æ”¾åœ¨äº†æ–‡æœ«ï¼ŒåŒ…æ‹¬ä¸€äº›æˆ‘è®¤ä¸ºè®²è§£åœ°ä¸é”™çš„<code>angr</code>ç›¸å…³çš„æ–‡ç« ã€‚æ‰€æœ‰é¢˜è§£æˆ‘æ‰“ç®—åˆ†æˆ<strong>åŸºç¡€ç¯‡</strong>ï¼Œ<strong>æé«˜ç¯‡</strong>ï¼Œ<strong>è¿›é˜¶ç¯‡</strong>ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¯¹åº”ä¸‰ç¯‡æ–‡ç« æ¥å®Œæˆï¼Œæœ¬æ–‡å±äº<strong>åŸºç¡€ç¯‡</strong>ã€‚</p>
<div class="note note-warning">
            <p>ç”±äºæœ¬äººä¹Ÿæ˜¯åˆå­¦ï¼Œæ–‡ç« ä¸­è®¸å¤šç†è§£éƒ½æ˜¯å»ºäºå‚è€ƒèµ„æ–™å’Œä¸ªäººçš„æ€è€ƒä¸Šï¼Œéš¾å…å­˜åœ¨çº°æ¼æˆ–ç†è§£ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæœ›å¤§ä½¬å‘ç°åèƒ½åŠæ—¶æŒ‡å‡ºï¼Œä¸èƒœæ„Ÿæ¿€ğŸ™</p>
          </div>
<blockquote>
<p>å¯¹äºangr_ctfçš„ä½¿ç”¨ï¼Œç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œæ¯ä¸ªé¢˜ç›®éƒ½åŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><code>xx_angr_xx.c.templite</code>: cæºç æ¨¡æ¿æ–‡ä»¶</li>
<li><code>generate.py</code>: åŸä»“åº“ä¸­æ²¡æœ‰ç°æˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨è€…é€šè¿‡æ‰§è¡Œ<code>python generate.py 123 filename</code>çš„æ–¹å¼æ¥æ‰‹åŠ¨ç¼–è¯‘ï¼ˆ123æ˜¯éšæœºæ•°ï¼Œç”¨äºæ··æ·†ï¼‰</li>
<li><code>scaffoldxx.py</code>ï¼šè§£é¢˜æç¤ºï¼Œä½œè€…åœ¨å…³é”®ä½ç½®ç”¨<code>???,...</code>çš„æ–¹å¼è¿›è¡Œäº†æ›¿ä»£ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯å®˜æ–¹æä¾›çš„è§£é¢˜æ¨¡æ¿</li>
<li><code>solve.py</code>ï¼šä½äº<code>solutions</code>ï¼Œæ˜¯é¢˜è§£</li>
</ul>
</blockquote>
<h2 id="00-angr-find"><a href="#00-angr-find" class="headerlink" title="00_angr_find"></a>00_angr_find</h2><p>ç›´æ¥æ‹–åˆ°idaä¸­æŸ¥çœ‹ä¸€ä¸‹æºä»£ç ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">int</span> __cdecl main<span class="token punctuation">(</span><span class="token builtin">int</span> argc<span class="token punctuation">,</span> const char <span class="token operator">**</span>argv<span class="token punctuation">,</span> const char <span class="token operator">**</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token builtin">int</span> i<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>1Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1Ch<span class="token punctuation">]</span>
  char s1<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>23h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>15h<span class="token punctuation">]</span>
  unsigned <span class="token builtin">int</span> v6<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>2Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>Ch<span class="token punctuation">]</span>

  v6 <span class="token operator">=</span> __readgsdword<span class="token punctuation">(</span>0x14u<span class="token punctuation">)</span><span class="token punctuation">;</span>
  printf<span class="token punctuation">(</span><span class="token string">"Enter the password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  __isoc99_scanf<span class="token punctuation">(</span><span class="token string">"%8s"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i <span class="token punctuation">)</span>
    s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> complex_function<span class="token punctuation">(</span>s1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !strcmp<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"DVNBCPLR"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts<span class="token punctuation">(</span><span class="token string">"Good Job."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    puts<span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
<span class="token builtin">int</span> __cdecl complex_function<span class="token punctuation">(</span>signed <span class="token builtin">int</span> a1<span class="token punctuation">,</span> <span class="token builtin">int</span> a2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1 <span class="token operator">&lt;=</span> <span class="token number">64</span> <span class="token operator">|</span><span class="token operator">|</span> a1 <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    puts<span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> a2 <span class="token operator">+</span> a1 <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>é¢˜æ„å¾ˆç®€å•ï¼Œå¯¹ä¸€ä¸ªè¾“å…¥çš„é•¿åº¦ä¸º7çš„å­—ç¬¦ä¸²æ¯ä¸€ä½åšä¸€ä¸ªå˜æ¢<code>complex_function</code>,ç„¶åå’Œç›®æ ‡å­—ç¬¦ä¸²<code>DVNBCPLR</code>æ¯”å¯¹ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™æ­£ç¡®ã€‚åŒæ—¶è¿˜é™åˆ¶äº†å­—ç¬¦çš„èŒƒå›´ä¸º<code>[64,90)</code>ã€‚</p>
<ul>
<li><p><strong>æš´åŠ›ç ´è§£</strong>    </p>
<p>åªéœ€è¦ä¸€ä¸ªåŒé‡forå¾ªç¯ï¼Œç¬¬ä¸€å±‚éå†å­—ç¬¦ä¸²ä½æ•°ï¼Œç¬¬äºŒå±‚éå†å¯é€‰çš„å­—ç¬¦ä¸²ï¼Œç„¶ååˆ¤æ–­æ¯ä¸€ä¸ªå˜æ¢åçš„å­—ç¬¦ä¸ç›®æ ‡å­—ç¬¦æ˜¯å¦ç›¸ç­‰å³å¯ï¼Œè§£ç­”å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">complex_function</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> a2 <span class="token operator">+</span> a1 <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span>

<span class="token keyword">def</span> <span class="token function">violence_solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    find a string, for each character in the string, after transfered by function complex_function, it will be the same as the target character in target_str(password)
    :return:
    '''</span>
    target_str <span class="token operator">=</span> <span class="token string">'DVNBCPLR'</span>
    flag <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>complex_function<span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> v<span class="token punctuation">:</span>
                flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'[+] Success, flag is </span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<ul>
<li><p><strong>angrè§£ç­”</strong>  </p>
<p>angrçš„å¼ºå¤§åœ¨äºä»–èƒ½éå†ç¨‹åºçš„è·¯å¾„ï¼Œæ‰¾å‡ºèƒ½å¤Ÿæ‰§è¡Œåˆ¶å®šè·¯å¾„çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆæ ¸å¿ƒå°±æ˜¯ç¬¦å·æ‰§è¡Œçš„æ€æƒ³ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ç»™å®šæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œåˆ°çš„è·¯å¾„ï¼Œç„¶åæ‹¿åˆ°å¯¹åº”çš„è¾“å…¥ç”¨ä¾‹å³å¯ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œå¸Œæœ›æ‰§è¡Œçš„è·¯å¾„åˆ°è¾¾<code>puts(&quot;Good Job&quot;)</code>ï¼Œåªéœ€è¦ç»™angræä¾›å¯¹åº”è¯¥è¯­å¥æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼ˆé€šè¿‡idaæŸ¥çœ‹å¾—åˆ°ï¼‰ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210430153731.png" srcset="/img/loading.gif" alt=""></p>
<p>ä¸‹é¢å¯¹åº”é¢˜è§£ä¸­çš„ä»£ç è¾…ä»¥æ³¨é‡Šæ¥ç†è§£æ•´ä¸ªè¿‡ç¨‹ä¸­angråšçš„äº‹æƒ…ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">angr_solve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'00_angr_find'</span>  <span class="token comment"># äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>  <span class="token comment"># å°†äºŒè¿›åˆ¶æ–‡ä»¶è£…è½½æˆangrä¸­æŒ‡å®šçš„Projectå¯¹è±¡</span>
	
    <span class="token comment"># factoryæä¾›äº†Projectå¯¹è±¡çš„ä¸€ç³»åˆ—è°ƒç”¨æ¥å£ï¼Œentry_state()åˆ™æ˜¯æä¾›äº†ä¸€ä¸ªç¨‹åºçš„å®ä¾‹é•œåƒ(SimStateå¯¹è±¡)ï¼Œ</span>
    <span class="token comment"># æ¨¡æ‹Ÿç¨‹åºæ‰§è¡ŒæŸä¸ªæ—¶åˆ»çš„çŠ¶æ€ï¼ˆè®°å½•ä¸€ç³»åˆ—ç¨‹åºè¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¦‚å†…å­˜/å¯„å­˜å™¨/æ–‡ä»¶ç³»ç»Ÿæ•°æ®ï¼‰ï¼Œä¸€èˆ¬æˆ‘ä»¬é€‰æ‹©ç¨‹åºçš„å…¥å£</span>
    <span class="token comment"># çŠ¶æ€entry_state()å³å¯ï¼Œç¨‹åºä¼šä»mainå‡½æ•°å¼€å§‹è¿è¡Œ</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span><span class="token punctuation">)</span>  
	
    <span class="token comment"># æœ‰äº†çŠ¶æ€ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿç¨‹åºçš„è¿è¡Œï¼Œå³ç”¨åˆ°`Simulation Managers`(ç¼©å†™æ˜¯simgr)ï¼Œæ¥å—ä¸€ä¸ªçŠ¶æ€ä¿¡æ¯åˆå§‹åŒ–ï¼Œ</span>
    <span class="token comment"># é€šè¿‡æ“æ§simgrè¾¾åˆ°æ¨¡æ‹Ÿç¨‹åºè¿è¡Œçš„ç›®çš„</span>
    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>
	
    <span class="token comment"># ç¨‹åºéœ€è¦æ£€ç´¢çš„ç›®çš„åœ°å€ï¼Œé€šè¿‡ä¸€ä¸ªå…·ä½“çš„å†…å­˜åœ°å€ï¼Œè¡¨ç¤ºè·¯å¾„éœ€è¦ç»è¿‡çš„èŠ‚ç‚¹ï¼Œæ¢è¨€ä¹‹ï¼Œå°±æ˜¯æˆ‘ä»¬æƒ³è¦è·¯å¾„çš„é™åˆ¶æ¡ä»¶</span>
    <span class="token comment"># é€šè¿‡simgrçš„explore()å‡½æ•°å®ç°æŸ¥æ‰¾ï¼Œè¿™é‡Œçš„åœ°å€ä½¿ç”¨idaä¸­çœ‹åˆ°çš„Good Jobå¯¹åº”çš„å†…å­˜åœ°å€</span>
    print_good_address <span class="token operator">=</span> <span class="token number">0x08048678</span>  
    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>print_good_address<span class="token punctuation">)</span>
	
    <span class="token comment"># simgrä¼šæŠŠæ‰¾åˆ°çš„ç¬¦åˆè¦æ±‚çš„è·¯å¾„å­˜å‚¨åœ¨foundä¸­ï¼Œå–ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„çŠ¶æ€ï¼Œposix.dumps(sys.stdin.fileno())åˆ™æ˜¯</span>
    <span class="token comment"># è·å–å½“å‰çŠ¶æ€ä¸‹stdinè¾“å…¥çš„æ•°æ®ï¼Œå³ç¨‹åºçš„è¾“å…¥å€¼</span>
    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        solution <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># sys.stdin.fileno() ä»£è¡¨ç¨‹åºçš„æ ‡å‡†è¾“å…¥ï¼Œå…·ä½“å€¼ä¸º0</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Success, flag is &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210501165254.png" srcset="/img/loading.gif" alt=""></p>
<p>ç”±è¯¥é¢˜è§£æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹angråˆ†æç¨‹åºçš„è¿‡ç¨‹æœ‰ä¸€ä¸ªåŸºæœ¬çš„æ˜ åƒï¼š</p>
</li>
</ul>
<ol>
<li><p>åŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶ä¸º<code>Project</code>å¯¹è±¡</p>
</li>
<li><p>è·å–ç¨‹åºçš„åˆå§‹åŒ–çŠ¶æ€<code>state</code></p>
</li>
<li><p>åˆ›å»ºç¨‹åºçš„æ¨¡æ‹Ÿç®¡ç†å™¨<code>simgr</code>ï¼Œç”¨äºæ§åˆ¶ç¨‹åºçš„æ¨¡æ‹Ÿè¿è¡Œï¼Œä»æˆ‘ä»¬æä¾›çš„åˆå§‹åŒ–çŠ¶æ€<code>state</code>å¼€å§‹</p>
</li>
<li><p>è®¾å®šè¦<code>find</code>çš„è·¯å¾„(é€šè¿‡å†…å­˜åœ°å€çš„é™åˆ¶æ–¹å¼æˆ–å…¶ä»–)ï¼Œè®°å½•è¯¥è·¯å¾„ä¸‹çš„<code>state</code>ä¿¡æ¯ï¼Œæ‰§è¡Œ<code>expolre</code></p>
</li>
<li><p>æ£€æŸ¥è·¯å¾„æŸ¥æ‰¾ç»“æœï¼Œè·å–è·¯å¾„ç›¸åº”çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶ä»<code>state</code>ä¸­æå–éœ€è¦çš„ä¿¡æ¯ï¼ˆå¦‚æ ‡å‡†è¾“å…¥çš„å€¼ï¼‰</p>
</li>
</ol>
<p>åˆ°æ­¤ï¼Œè¿™ä¸ªé¢˜ç®—æ˜¯åšå®Œäº†ï¼Œä½†å¯¹äº<code>angr</code>çš„ç†è§£ç›®å‰ä¹Ÿä»…ä»…æ˜¯ä¼šç”¨ä¸€ç‚¹è€Œå·²ï¼Œåé¢æ ¹æ®æ›´å¤šçš„é¢˜ç›®ç»ƒä¹ æ¥åŠ æ·±å¯¹<code>angr</code>çš„æŒæ¡ï¼ŒåŒæ—¶æ…¢æ…¢ç†è§£å…¶å†…éƒ¨çš„è¿è¡Œæœºåˆ¶ã€‚</p>
<h2 id="01-angr-avoid"><a href="#01-angr-avoid" class="headerlink" title="01_angr_avoid"></a>01_angr_avoid</h2><p>è¯¥é¢˜ä¸­mainå‡½æ•°çš„ä»£ç éå¸¸é•¿ï¼Œç›´æ¥ç”¨<code>ida</code>åç¼–è¯‘æºä»£ç è§£æä¸å‡ºæ¥ï¼Œè¿™é‡Œç”¨åˆ°å¦å¤–ä¸€ä¸ªæºä»£ç åç¼–è¯‘å·¥å…·<a target="_blank" rel="noopener" href="https://github.com/avast/retdec">retdec</a>ï¼Œå®˜ç½‘çš„ä½¿ç”¨éƒ¨åˆ†æœ‰ä¸€ç‚¹ç¼ºé™·ï¼ˆæˆ‘ä¸‹è½½æœ€æ–°çš„å·²ç¼–è¯‘ç¨‹åºæ˜¯pythonè„šæœ¬ï¼‰ï¼Œå°†</p>
<div class="code-wrapper"><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$RETDEC_INSTALL_DIR\bin\retdec-decompiler.exe test.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>
<p>æ”¹æˆ</p>
<div class="code-wrapper"><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ python RETDEC_INSTALL_DIR\bin\retdec-decompiler.py test.exe<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>
<p>æºä»£ç éå¸¸å¤šï¼ˆæ¥è¿‘7wè¡Œï¼‰ï¼Œä½†å¤§éƒ¨åˆ†æ˜¯é‡å¤æ€§çš„åƒåœ¾ä»£ç ï¼Œå°†å…¶ä¸­æ ¸å¿ƒçš„éƒ¨åˆ†æ‘˜å½•å‡ºæ¥å¾—åˆ°ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// ------------------- Function Prototypes --------------------</span>

<span class="token class-name">int32_t</span> <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">int32_t</span> <span class="token function">complex_function</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> a1<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">int32_t</span> <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> str<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> str2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// --------------------- Global Variables ---------------------</span>

<span class="token keyword">char</span> g1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 0x80d603d</span>
<span class="token class-name">int32_t</span> g2<span class="token punctuation">;</span>

<span class="token comment">// ------------------------ Functions -------------------------</span>

<span class="token comment">// Address range: 0x8048549 - 0x80485a8</span>
<span class="token class-name">int32_t</span> <span class="token function">complex_function</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> a1<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> a2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">uint32_t</span> v1 <span class="token operator">=</span> a1 <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v1 <span class="token operator">&lt;</span> <span class="token number">26</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">int32_t</span> v2 <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> a2<span class="token punctuation">;</span> <span class="token comment">// 0x8048583</span>
        <span class="token class-name">int32_t</span> v3 <span class="token operator">=</span> v2 <span class="token operator">+</span> v1<span class="token punctuation">;</span> <span class="token comment">// 0x8048585</span>
        <span class="token keyword">return</span> v2 <span class="token operator">+</span> a1 <span class="token operator">+</span> v3 <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">-</span> v3<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 0x804855b</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// UNREACHABLE</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Address range: 0x80485a8 - 0x80485b5</span>
<span class="token class-name">int32_t</span> <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 0x80485a8</span>
    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x80d603d</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> result<span class="token punctuation">;</span> <span class="token comment">// 0x80485a8</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Address range: 0x80485b5 - 0x8048602</span>
<span class="token class-name">int32_t</span> <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> str<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> str2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 0x80485b5</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>g1 <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">strncmp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>str<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>str2<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 0x80485ff</span>
        <span class="token keyword">return</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 0x80485ff</span>
    <span class="token keyword">return</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Good Job."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// Address range: 0x8048602 - 0x80d458d</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">int32_t</span> v1 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0x804861b</span>
    <span class="token class-name">int32_t</span> v2<span class="token punctuation">;</span> <span class="token comment">// bp-40, 0x8048602</span>
    <span class="token class-name">int32_t</span> v3 <span class="token operator">=</span> <span class="token operator">&amp;</span>v2<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 0x804862f</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">+</span> v3<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 0x8048644</span>
    <span class="token class-name">int32_t</span> v4<span class="token punctuation">;</span> <span class="token comment">// bp-96, 0x8048602</span>
    <span class="token class-name">int32_t</span> v5 <span class="token operator">=</span> <span class="token operator">&amp;</span>v4<span class="token punctuation">;</span> <span class="token comment">// 0x8048610</span>
    v2 <span class="token operator">=</span> <span class="token number">0x5a4c5850</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> v6<span class="token punctuation">;</span> <span class="token comment">// bp-60, 0x8048602</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%8s"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> v7 <span class="token operator">=</span> <span class="token operator">&amp;</span>v6<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> <span class="token operator">*</span> v8 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v5 <span class="token operator">-</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span> <span class="token operator">*</span> v9 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v5 <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> <span class="token operator">*</span> v10 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">+</span> v7<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0x8048689</span>
        <span class="token operator">*</span>v8 <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token operator">*</span>v9 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">*</span>v10<span class="token punctuation">;</span>
        <span class="token operator">*</span>v10 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token function">complex_function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">uint32_t</span> v11<span class="token punctuation">;</span> <span class="token comment">// 0x8048602</span>
    <span class="token class-name">uint32_t</span> v12<span class="token punctuation">;</span> <span class="token comment">// 0x8048602</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v12 <span class="token operator">&amp;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v11 <span class="token operator">&amp;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 0x808e62f</span>
        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v12 <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v11 <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v12 <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v11 <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v12 <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v11 <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 0x80cb9bf</span>
                    <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>v12 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>v11 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// 0x80cffb7</span>
                        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">^</span> v6<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                        <span class="token comment">// 0x80d4149</span>
                                        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                            <span class="token comment">// 0x80d4379</span>
                                            <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                <span class="token comment">// 0x80d4491</span>
                                                <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                    <span class="token comment">// 0x80d4515</span>
                                                    <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>v6 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>v2 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d455c</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d4542</span>
                                                        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>v6 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>v2 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d4500</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d44e6</span>
                                                        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                <span class="token punctuation">&#125;</span>
                                            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> 
                                                <span class="token comment">// åœ¨æ­¤ä¹‹åä¸€ç›´æ˜¯è¿™æ ·çš„é‡å¤ä»£ç </span>
                                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v6 <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v2 <span class="token operator">&amp;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                    <span class="token comment">// 0x80d442f</span>
                                                    <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>v6 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>v2 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d4479</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d445c</span>
                                                        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>v6 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token punctuation">(</span>v2 <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d4417</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                                                        <span class="token comment">// 0x80d43fa</span>
                                                        <span class="token function">avoid_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v8 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
                                                        <span class="token operator">*</span>v9 <span class="token operator">=</span> v7<span class="token punctuation">;</span>
                                                        <span class="token function">maybe_good</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                                    <span class="token punctuation">&#125;</span>
                                                <span class="token punctuation">&#125;</span>
                                            <span class="token punctuation">&#125;</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">int32_t</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0x80d457e</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>v1 <span class="token operator">!=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 0x80d4580</span>
        <span class="token function">__stack_chk_fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result <span class="token operator">=</span> <span class="token operator">&amp;</span>g2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 0x80d4585</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>å¯ä»¥çœ‹å‡ºç¨‹åºç”±å¤§é‡çš„ifè¯­å¥å †ç Œï¼Œéå¸¸é€‚åˆç”¨ç¬¦å·æ‰§è¡Œçš„æ–¹å¼éå†è·¯å¾„ï¼Œä¸ºäº†å‡å°‘éå†çš„è·¯å¾„æ•°ï¼Œæé«˜æœç´¢æ•ˆç‡ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…è®©ç¨‹åºè¿›å…¥æˆ‘ä»¬ä¸å¸Œæœ›æ‰§è¡Œçš„åˆ†æ”¯ä¸­ï¼Œåœ¨æœ¬é¢˜ä¸­å°±æ˜¯<code>avoid_me()</code>ï¼Œè¿™å°±ç”¨åˆ°äº†<code>explore()</code>çš„å¦ä¸€å‚æ•°<code>avoid</code>ï¼Œå®ƒç”¨äºæŒ‡å®šä¸å¸Œæœ›ç¨‹åºè¿›å…¥çš„è·¯å¾„ã€‚</p>
<p>ä¸‹é¢ç»™å‡ºé¢˜è§£ï¼Œå¹¶é™„ä¸Šå¿…è¦æ³¨é‡Šï¼ˆå‰é¢å·²ç»è®²è¿‡çš„å†…å®¹ä¼šç®€ç•¥ï¼‰ï¼š</p>
<blockquote>
<p>ä¸¤ä¸ªå¿…è¦çš„åœ°å€ä¿¡æ¯åœ¨ä¸Šè¿°çš„æºä»£ç ä¸­å·²å­˜åœ¨</p>
</blockquote>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  path_to_binary <span class="token operator">=</span> <span class="token string">'01_angr_avoid'</span>

  <span class="token comment"># åŠ è½½ç¨‹åºä¸ºProjectå¯¹è±¡</span>
  project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>
  <span class="token comment">#ã€€è·å–åˆå§‹åŒ–çŠ¶æ€</span>
  initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment"># æ¨¡æ‹Ÿæ‰§è¡Œ</span>
  simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

  <span class="token comment">#ã€€æˆ‘ä»¬æƒ³è¦è¿›å…¥çš„åˆ†æ”¯åœ°å€ï¼Œæ­¤å¤„å¯¹åº”Good Jobçš„è¯­å¥ã€€</span>
  print_good_address <span class="token operator">=</span> <span class="token number">0x80485ff</span>  <span class="token comment"># æ£€æŸ¥æºä»£ç ä¸­ Good Jobå¯¹åº”åœ°å€</span>
  <span class="token comment"># ä¸å¸Œæœ›æ‰§è¡Œçš„åˆ†æ”¯ï¼Œæ­¤å¤„å¯¹åº”avoid_me()å‡½æ•°çš„åœ°å€</span>
  will_not_succeed_address <span class="token operator">=</span> <span class="token number">0x80485a8</span>  <span class="token comment"># æ£€æŸ¥æºä»£ç ä¸­ avoid_me()å¯¹åº”åœ°å€</span>
  simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>print_good_address<span class="token punctuation">,</span> avoid<span class="token operator">=</span>will_not_succeed_address<span class="token punctuation">)</span>

  <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
    solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    solution <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Success, flag is &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
  main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210501165557.png" srcset="/img/loading.gif" alt=""></p>
<blockquote>
<p>ä½ å¯ä»¥å°è¯•å»æ‰avoidå‚æ•°ï¼ŒåŒæ ·èƒ½å¤Ÿè¾¾åˆ°ç›®çš„ï¼Œä½†æ—¶é—´ä¸ŠèŠ±é”€ä¼šæ›´å¤š~</p>
</blockquote>
<h2 id="02-angr-find-condition"><a href="#02-angr-find-condition" class="headerlink" title="02_angr_find_condition"></a>02_angr_find_condition</h2><p>æœ¬é¢˜ä¸ç¬¬ä¸€é¢˜æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é¡¾åæ€ä¹‰ï¼Œé€šè¿‡<code>condition</code>çš„æ–¹å¼æ¥é€‰æ‹©<code>find</code>å’Œ<code>avoid</code>çš„åˆ†æ”¯ï¼Œä¹‹å‰æˆ‘ä»¬ä¸€ç›´æ˜¯åç¼–è¯‘ä¹‹åæ‰‹åŠ¨å¡«å†™ç›¸åº”çš„è¯­å¥å†…å­˜åœ°å€ï¼Œå®é™…ä¸Šåœ¨é€‰æ‹©åˆ†æ”¯çš„æ—¶å€™å¯ä»¥æ ¹æ®å¯¹åº”çš„è¾“å‡ºç»“æœæ¥åˆ¤æ–­ï¼Œåœ¨<code>explore</code>çš„æ—¶å€™ä¼ å…¥å‡½æ•°ï¼Œç”¨äºæŒ‡å®šä»€ä¹ˆæƒ…å†µä¸‹é€‰æ‹©è¯¥è·¯å¾„ï¼Œä»€ä¹ˆæ—¶å€™è·³è¿‡è¯¥è·¯å¾„ï¼Œå³å®šä¹‰ï¼š</p>
<ul>
<li><code>is_successful(state)</code>: è¿›å…¥åˆ†æ”¯çš„æ¡ä»¶</li>
<li><code>should_abort(state)</code>: è·³è¿‡åˆ†æ”¯çš„æ¡ä»¶</li>
</ul>
<p>æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'02_angr_find_condition'</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># åœ¨å¯¹è¾“å‡ºè¿›è¡Œåˆ¤æ–­çš„æ—¶å€™æœ‰ä¸¤ç§æ–¹å¼ï¼Œstr compare or bytes compare</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        <span class="token comment"># return True if b'Good Job.' in stdout_output else False</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        solution <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Success, flag is &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210501165755.png" srcset="/img/loading.gif" alt=""></p>
<h2 id="03-angr-symbolic-registers"><a href="#03-angr-symbolic-registers" class="headerlink" title="03_angr_symbolic_registers"></a>03_angr_symbolic_registers</h2><p>å…ˆçœ‹ä¸‹åç¼–è¯‘ä»£ç ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// ebx</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// ST1C_4</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// ST14_4</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// [esp+8h] [ebp-10h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v10<span class="token punctuation">;</span> <span class="token comment">// [esp+Ch] [ebp-Ch]</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token function">get_user_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v6 <span class="token operator">=</span> v5<span class="token punctuation">;</span>
  v7 <span class="token operator">=</span> <span class="token function">complex_function_1</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v9 <span class="token operator">=</span> <span class="token function">complex_function_2</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v10 <span class="token operator">=</span> <span class="token function">complex_function_3</span><span class="token punctuation">(</span>v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v7 <span class="token operator">||</span> v9 <span class="token operator">||</span> v10 <span class="token punctuation">)</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Good Job."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">get_user_input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-18h]</span>
  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// [esp+4h] [ebp-14h]</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// [esp+8h] [ebp-10h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [esp+Ch] [ebp-Ch]</span>

  v4 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%x %x %x"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> v1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> __cdecl <span class="token function">complex_function_1</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a1 <span class="token operator">^</span> <span class="token number">0x446D96EE</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65034369</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x8C9C6B06</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">506201578</span> <span class="token operator">+</span> <span class="token number">1306428696</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x11B9DE9C</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1979576599</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xF1A3C94B</span><span class="token punctuation">)</span>
           <span class="token operator">+</span> <span class="token number">1419260309</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x92896C8</span><span class="token punctuation">)</span>
         <span class="token operator">-</span> <span class="token number">383475520</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xA2B0AE1F</span><span class="token punctuation">)</span>
       <span class="token operator">-</span> <span class="token number">963798047</span>
       <span class="token operator">+</span> <span class="token number">2098953909</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">unsigned</span> <span class="token keyword">int</span> __cdecl <span class="token function">complex_function_2</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a1 <span class="token operator">^</span> <span class="token number">0xFA55CC03</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1408082538</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xF637E394</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1155370027</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xC6F7A83A</span><span class="token punctuation">)</span>
                     <span class="token operator">-</span> <span class="token number">286307825</span>
                     <span class="token operator">+</span> <span class="token number">847018205</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x9E46424</span><span class="token punctuation">)</span>
                   <span class="token operator">+</span> <span class="token number">829215924</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xD0D3A782</span><span class="token punctuation">)</span>
                 <span class="token operator">+</span> <span class="token number">267178483</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x6595F087</span><span class="token punctuation">)</span>
               <span class="token operator">+</span> <span class="token number">1151870818</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x8529CCF3</span><span class="token punctuation">)</span>
             <span class="token operator">-</span> <span class="token number">2092276806</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xCBDB3CE1</span><span class="token punctuation">)</span>
           <span class="token operator">-</span> <span class="token number">1204004829</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x6E55C638</span><span class="token punctuation">)</span>
         <span class="token operator">+</span> <span class="token number">1720283269</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xAEFB68D3</span><span class="token punctuation">)</span>
       <span class="token operator">+</span> <span class="token number">1956986548</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> __cdecl <span class="token function">complex_function_3</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a1 <span class="token operator">^</span> <span class="token number">0xFD2D6C3F</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">831184883</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x6633C3C9</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">358411895</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xC4FF8776</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">763680393</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xEAE4DB7B</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> <span class="token number">954507130</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xF35005F6</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>ç¨‹åºå¯¹ç”¨æˆ·è¾“å…¥çš„ä¸‰ä¸ªå€¼è¿›è¡Œäº†ä¸åŒçš„ä¸‰ç§å˜æ¢ï¼Œæœ€ç»ˆéœ€è¦å˜æ¢åçš„ä¸‰ä¸ªå˜é‡åŒæ—¶æ»¡è¶³ä¸º<code>false</code>ï¼Œå…¶å®æœ¬è´¨ä¸Šå’Œä¹‹å‰çš„é¢˜ä¸€æ ·ï¼Œæˆ‘ä»¬ä¾ç„¶èƒ½ç”¨ä¹‹å‰çš„æ–¹æ³•è§£å†³ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">basic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'03_angr_symbolic_registers'</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token comment"># Define a function that checks if you have found the state you are looking</span>
    <span class="token comment"># for.</span>
    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Dump whatever has been printed out by the binary so far into a string.</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Return whether 'Good Job.' has been printed yet.</span>
        <span class="token comment"># (!)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        <span class="token comment"># return True if b'Good Job.' in stdout_output else False</span>

        <span class="token comment"># Same as above, but this time check if the state should abort. If you return</span>
        <span class="token comment"># False, Angr will continue to step the state. In this specific challenge, the</span>
        <span class="token comment"># only time at which you will know you should abort is when the program prints</span>
        <span class="token comment"># "Try again."</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token comment"># Tell Angr to explore the binary and find any state that is_successful identfies</span>
    <span class="token comment"># as a successful state by returning True.</span>
    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        solution <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Success, flag is &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>
        
        
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    basic<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502101525.png" srcset="/img/loading.gif" alt=""></p>
<p>è¿™éƒ¨åˆ†ä»£ç åº”è¯¥å¾ˆç†Ÿç»ƒäº†ï¼Œä½†æ€»æ˜¯ç”¨é‚£ä¸‰æ¿æ–§ï¼Œé‡åˆ°æ›´åŠ å¤æ‚çš„é—®é¢˜å¯èƒ½å°±æŠ¡ä¸åŠ¨äº†ã€‚æœ¬é¢˜å®é™…ä¸Šæ˜¯å¸Œæœ›æˆ‘ä»¬å­¦ä¼šåˆ©ç”¨angræ¥å®ç°å¯¹å¯„å­˜å™¨ä¸­å€¼çš„æ“ä½œã€‚</p>
<ul>
<li>éœ€è¦æ§åˆ¶çš„å˜é‡åœ¨<code>get_user_input</code> è¾“å…¥éƒ¨åˆ†ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¯¥æœ¬éƒ¨åˆ†çš„æ±‡ç¼–ä»£ç </li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502102553.png" srcset="/img/loading.gif" alt=""></p>
<blockquote>
<p>è·å–äº†ä¸‰ä¸ªè¾“å…¥ï¼Œå¹¶åˆ†åˆ«ä¿å­˜åˆ°äº†<code>eax</code>,<code>ebx</code>,<code>edx</code>å¯„å­˜å™¨ä¸­(<strong>æ³¨æ„ç¬¬ä¸€ä¸ªæ”¹å˜å¯„å­˜å™¨å€¼ç›¸åº”çš„å†…å­˜åœ°å€<code>0804881E</code>ï¼Œåé¢ç”¨åˆ°</strong>)ï¼Œæ„å‘³ç€æˆ‘ä»¬å¦‚æœèƒ½ä¿®æ”¹å¯„å­˜å™¨çš„å€¼ï¼Œé‚£ä¹ˆç›´æ¥ä¿®æ”¹è¿™ä¸‰ä¸ªå¯„å­˜å™¨ï¼Œå°±ä¸éœ€è¦ä»mainå‡½æ•°å…¥å£è¿›å…¥äº†ï¼Œæ°å·§angrå°±æ”¯æŒè¿™ç§æ“ä½œã€‚é™¤äº†ä»æ±‡ç¼–ä»£ç ï¼Œä¹Ÿå¯ä»¥ä»åç¼–è¯‘åçš„æ³¨é‡Šä¸­å‘ç°ä¼ å…¥çš„ä¸‰ä¸ªå˜é‡å­˜å‚¨çš„å¯„å­˜å™¨</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502102840.png" srcset="/img/loading.gif" alt=""></p>
</blockquote>
<ul>
<li>å½“æˆ‘ä»¬ä¸ä»mainå‡½æ•°å…¥å£è¿›å…¥æ—¶ï¼Œåœ¨åˆå§‹åŒ–<code>state</code>çš„æ—¶å€™å°±ä¸ç”¨<code>entry_state()</code>äº†ï¼Œæ”¹ç”¨<code>blank_state()</code>ï¼Œå®ƒç”¨äºåˆ›å»ºä¸€ä¸ªç©ºçš„çŠ¶æ€ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯â€œç©ºé™â€åˆ°ç¨‹åºçš„æŸä¸€ä½ç½®çš„ï¼Œæ­¤æ—¶ç¨‹åºæ‰€æœ‰çš„çŠ¶æ€éœ€è¦æˆ‘ä»¬è‡ªå·±æŒ‡å®šï¼Œä¸‹è¡¨è§£é‡Šäº†å¸¸ç”¨çš„çŠ¶æ€æ„é€ æ–¹æ³•<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="AngrCTF_FITM/Angr_CTFä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸€ï¼‰.md at master Â· ZERO-A-ONE/AngrCTF_FITM (github.com)
">[1]</span></a></sup>ï¼š</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>entry_state()</code></td>
<td>æ„é€ ä¸€ä¸ªå·²ç»å‡†å¤‡å¥½ä»å‡½æ•°å…¥å£ç‚¹(<code>main</code>)æ‰§è¡Œçš„çŠ¶æ€</td>
</tr>
<tr>
<td><code>blank_state()</code></td>
<td>æ„é€ ä¸€ä¸ªâ€œç©ºçŠ¶æ€â€ï¼Œå®ƒçš„å¤§å¤šæ•°æ•°æ®éƒ½æ˜¯æœªåˆå§‹åŒ–çš„ã€‚å½“ä½¿ç”¨æœªåˆå§‹åŒ–çš„çš„æ•°æ®æ—¶ï¼Œä¸€ä¸ªä¸å—çº¦æŸçš„ç¬¦å·å€¼å°†ä¼šè¢«è¿”å›ï¼Œ<strong>è®°ä½å½“éœ€è¦ä»ç¨‹åºä¸­ä»»æ„ä¸€ç‚¹æ‰§è¡Œçš„æ—¶å€™ä½¿ç”¨</strong></td>
</tr>
<tr>
<td><code>call_state()</code></td>
<td>æ„é€ ä¸€ä¸ªå·²ç»å‡†å¤‡å¥½æ‰§è¡ŒæŸä¸ªå‡½æ•°çš„çŠ¶æ€</td>
</tr>
<tr>
<td><code>full_init_state()</code></td>
<td>æ„é€ ä¸€ä¸ªå·²ç»æ‰§è¡Œè¿‡æ‰€æœ‰ä¸éœ€è¦æ‰§è¡Œçš„åˆå§‹åŒ–å‡½æ•°ï¼Œå¹¶å‡†å¤‡ä»å‡½æ•°å…¥å£ç‚¹æ‰§è¡Œçš„çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œå…±äº«åº“æ„é€ å‡½æ•°ï¼ˆconstructorï¼‰æˆ–é¢„åˆå§‹åŒ–å™¨ã€‚å½“è¿™äº›æ‰§è¡Œå®Œä¹‹åï¼Œç¨‹åºå°†ä¼šè·³åˆ°å…¥å£ç‚¹</td>
</tr>
</tbody>
</table>
</div>
<p>æœ‰äº†ä¸Šé¢çš„åŸºç¡€çŸ¥è¯†åï¼Œçœ‹é¢˜è§£æºç ï¼Œæˆ‘ä¼šåœ¨å¿…è¦çš„ä½ç½®æ·»åŠ æ³¨é‡Šå¸®åŠ©ç†è§£ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> claripy

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">"03_angr_symbolic_registers"</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">,</span> auto_load_libs<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 0x0804881Eã€€è¿™ä¸ªåœ°å€æ˜¯å°†è¾“å…¥å€¼ä¼ å…¥å¯„å­˜å™¨çš„èµ·å§‹åœ°å€ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦çš„â€œç©ºé™â€ä½ç½®</span>
    start_address <span class="token operator">=</span> <span class="token number">0x0804881E</span>

    <span class="token comment"># ä¸å†æ˜¯entry_state()äº†ï¼Œé€šè¿‡ç»™å®šçš„èµ·å§‹åœ°å€ï¼Œåœ¨è¯¥å¤„åˆ›å»ºä¸€ä¸ªç©ºç™½çŠ¶æ€</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_address<span class="token punctuation">)</span>

    <span class="token comment"># è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä½å‘é‡ï¼Œå®é™…ä¸Šå°±æ˜¯ä¿å­˜å¯„å­˜å™¨å€¼çš„å˜é‡ï¼ˆå˜é‡åç§°éšæ„ï¼‰ï¼Œåœ¨ç¬¦å·æ‰§è¡Œä¸­ç”¨çš„ç¬¦å·å˜é‡ï¼Œå¦‚\alphaï¼Œ</span>
    <span class="token comment"># åˆ¶å®š32ä½æ˜¯å› ä¸ºç¨‹åºæœ¬èº«æ˜¯32ä½çš„</span>
    passwd_size_in_bits <span class="token operator">=</span> <span class="token number">32</span>
    passwd0 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'passwd0'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    passwd1 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'passwd1'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    passwd2 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'passwd2'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>

    <span class="token comment"># å°†ç¬¦å·å˜é‡å­˜å‚¨åˆ°å¯„å­˜å™¨ä¸­ï¼Œåœ¨ç¨‹åºæ¨¡æ‹Ÿæ‰§è¡Œé˜¶æ®µå°±ç”±è¿™äº›ç¬¦å·å€¼ä»£æ›¿å®é™…è¾“å…¥æ‰§è¡Œï¼Œä»¥éå†æ‰€æœ‰è·¯å¾„</span>
    initial_state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>eax <span class="token operator">=</span> passwd0
    initial_state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebx <span class="token operator">=</span> passwd1
    initial_state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>edx <span class="token operator">=</span> passwd2

    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        <span class="token comment"># åˆ†åˆ«å¯¹ä¸‰ä¸ªç¬¦å·å˜é‡è¿›è¡Œçº¦æŸæ±‚è§£ï¼Œè·å–æµ‹è¯•ç”¨ä¾‹ï¼Œformat(...,'x')æ˜¯å°†16è¿›åˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        solution0 <span class="token operator">=</span> <span class="token builtin">format</span><span class="token punctuation">(</span>solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>passwd0<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>
        solution1 <span class="token operator">=</span> <span class="token builtin">format</span><span class="token punctuation">(</span>solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>passwd1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>
        solution2 <span class="token operator">=</span> <span class="token builtin">format</span><span class="token punctuation">(</span>solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>passwd2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>

        <span class="token comment"># ä¸‹é¢çš„seæ–¹æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†å®˜æ–¹å·²ç»æç¤ºè¦ä¸¢å¼ƒä½¿ç”¨äº†ï¼Œå»ºè®®è¿˜æ˜¯ç”¨ä¸Šé¢çš„</span>
        <span class="token comment"># solution0 = format(solution_state.se.eval(passwd0),'x')</span>
        <span class="token comment"># solution1 = format(solution_state.se.eval(passwd1),'x')</span>
        <span class="token comment"># solution2 = format(solution_state.se.eval(passwd2),'x')</span>

        solution <span class="token operator">=</span> solution0 <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> solution1 <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> solution2
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Success! Solution is: &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502110615.png" srcset="/img/loading.gif" alt="image-20210502110608909"></p>
<h2 id="04-angr-symbolic-stack"><a href="#04-angr-symbolic-stack" class="headerlink" title="04_angr_symbolic_stack"></a>04_angr_symbolic_stack</h2><p>è€è§„çŸ©ï¼Œæ‰”idaé‡Œçœ‹ä¸‹ä»£ç </p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">handle_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">handle_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment">// [esp+8h] [ebp-10h]</span>
  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// [esp+Ch] [ebp-Ch]</span>

  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%u %u"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> <span class="token function">complex_function0</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token function">complex_function1</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v2 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1087905000</span> <span class="token operator">&amp;&amp;</span> v1 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">135078575</span> <span class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Good Job."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    result <span class="token operator">=</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> __cdecl <span class="token function">complex_function0</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> a1 <span class="token operator">^</span> <span class="token number">0x256BEDF0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">int</span> __cdecl <span class="token function">complex_function1</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> a1 <span class="token operator">^</span> <span class="token number">0x9D110FE4</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>çœ‹èµ·æ¥ä¹Ÿæ²¡ä»€ä¹ˆå·®åˆ«ï¼Œç”¨å¸¸è§„æ–¹æ³•ç›´æ¥<code>handle</code>æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æœ¬é¢˜è€ƒæŸ¥çš„æ˜¯å¯¹æ ˆçš„æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥å¯¹æ ˆåšå˜åŒ–ï¼Œç„¶åä»ä¸€ä¸ªæŒ‡å®šçš„åœ°æ–¹ç©ºé™åˆ°ç¨‹åºä¸­ç»§ç»­æ‰§è¡Œã€‚çœ‹ä¸€ä¸‹idaä¸­æ±‡ç¼–ä»£ç éƒ¨åˆ†ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502123113.png" srcset="/img/loading.gif" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åœ¨<code>0x08048697</code>å†™å…¥æ ˆä¸­çš„ï¼Œå› æ­¤ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦â€œç©ºé™â€çš„åœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶æ­¤æ—¶çš„æ ˆï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#            /-------- The stack --------\</span>
<span class="token comment"># ebp ->     |          padding          |</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment"># ebp - 0x01 |       more padding        |</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment">#                        . . .               </span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment"># ebp - 0x09 |   S1, last byte           |</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment">#                        . . .                    </span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment"># ebp - 0x0c |   S1, first byte          |</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment"># ebp - 0x0d |   S2, last byte           |</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment">#                        . . .</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment"># ebp - 0x10 |   S2, first byte          |</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment">#                        . . .</span>
<span class="token comment">#            |---------------------------|</span>
<span class="token comment"># esp ->     |                           |</span>
<span class="token comment">#            \---------------------------/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>å½“æˆ‘ä»¬è¦ä¿®æ”¹æ ˆä¸­å†…å®¹æ—¶ï¼Œéœ€è¦å°†ä¸¤ä¸ªå˜é‡(S2,S2)å†™å…¥åˆ°æ ˆä¸­ï¼Œä¸ºæ­¤ï¼Œéœ€è¦å…ˆå°†<code>esp</code>æŒ‡é’ˆæŠ¬é«˜ï¼Œå³ç»™è¦å‹å…¥çš„å‚æ•°ï¼ˆ2ä¸ªå‚æ•°æ¯ä¸ªå 4å­—èŠ‚ï¼Œä¸€å…±å ç”¨8å­—èŠ‚ï¼‰åˆ›å»ºç©ºé—´ï¼Œå¯¹åº”æ±‡ç¼–ä»£ç å°±æ˜¯<code>sub esp, 0x08</code></p>
<p>ä¸‹é¢æ˜¯å®Œæ•´çš„é¢˜è§£ï¼Œæˆ‘ä¼šåœ¨å¿…è¦çš„åœ°æ–¹æ·»åŠ æ³¨é‡Šï¼Œå¸®åŠ©ç†è§£ï¼š</p>
<blockquote>
<p>ä¸ºäº†ä¸æ™®é€šæ–¹æ³•å¯¹æ¯”ï¼Œæˆ‘å°†ç›´æ¥é€šè¿‡è¾“å‡ºæ±‚è§£çš„æ–¹æ³•<code>basic</code>ä¹ŸåŠ å…¥äº†å…¶ä¸­</p>
</blockquote>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">basic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'04_angr_symbolic_stack'</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token comment"># Tell Angr to explore the binary and find any state that is_successful identfies</span>
    <span class="token comment"># as a successful state by returning True.</span>
    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        solution <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+] Success, flag is &#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'04_angr_symbolic_stack'</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>

    <span class="token comment"># èµ·å§‹åœ°å€å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°è¢«å‹å…¥æ ˆä¸­çš„åœ°å€</span>
    start_address <span class="token operator">=</span> <span class="token number">0x08048697</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_address<span class="token punctuation">)</span>

    <span class="token comment">#ã€€ç”±äºè¦å¯¹æ ˆåšæ“ä½œï¼Œéœ€è¦å…ˆå°†espæŒ‡å‘ebp</span>
    initial_state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>ebp <span class="token operator">=</span> initial_state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp

    <span class="token comment"># æ„å»ºä¸¤ä¸ªä½å‘é‡ï¼Œå³ç¬¦å·å˜é‡ï¼ŒåŒæ ·æ˜¯ï¼“ï¼’ä½</span>
    passwd_size_in_bits <span class="token operator">=</span> <span class="token number">32</span>
    password0 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password0'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    password1 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password1'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>

    <span class="token comment"># ä¸‹é¢éœ€è¦å°†ç¬¦å·å˜é‡æ³¨å…¥æ ˆä¸­ï¼Œä¸ºæ­¤éœ€è¦å…ˆè…¾å‡ºä¸¤ä¸ªå˜é‡çš„ç©ºé—´ï¼Œå³2*4=8å­—èŠ‚</span>
    padding_length_in_bytes <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span><span class="token number">4</span>  <span class="token comment"># :integer</span>
    initial_state<span class="token punctuation">.</span>regs<span class="token punctuation">.</span>esp <span class="token operator">-=</span> padding_length_in_bytes

    <span class="token comment"># å°†å˜é‡å‹å…¥æ ˆä¸­</span>
    initial_state<span class="token punctuation">.</span>stack_push<span class="token punctuation">(</span>password0<span class="token punctuation">)</span>  <span class="token comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span>
    initial_state<span class="token punctuation">.</span>stack_push<span class="token punctuation">(</span>password1<span class="token punctuation">)</span>  <span class="token comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span>

    <span class="token comment"># ä¸‹é¢çš„æ­¥éª¤å°±å’Œå¯„å­˜å™¨çš„éƒ¨åˆ†ä¸€æ ·äº†</span>
    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        solution0 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password0<span class="token punctuation">)</span>
        solution1 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password1<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Success, flag is: &#123;&#125; &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution0<span class="token punctuation">,</span> solution1<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>
<span class="token comment">#</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># basic()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502132837.png" srcset="/img/loading.gif" alt=""></p>
<h2 id="05-angr-symbolic-memory"><a href="#05-angr-symbolic-memory" class="headerlink" title="05_angr_symbolic_memory"></a>05_angr_symbolic_memory</h2><p>ç…§ä¾‹æŸ¥çœ‹ä¸€ä¸‹åç¼–è¯‘çš„æºç ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [esp+Ch] [ebp-Ch]</span>

  <span class="token function">memset</span><span class="token punctuation">(</span>user_input<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x21u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%8s %8s %8s %8s"</span><span class="token punctuation">,</span> user_input<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_9FD92A8<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_9FD92B0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>unk_9FD92B8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">31</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">167613088</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">complex_function</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">167613088</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>user_input<span class="token punctuation">,</span> <span class="token string">"FINYOEXAGBOWGBBJRUCGWNQJZNFZTPPQ"</span><span class="token punctuation">,</span> <span class="token number">0x20u</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Good Job."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">int</span> __cdecl <span class="token function">complex_function</span><span class="token punctuation">(</span><span class="token keyword">signed</span> <span class="token keyword">int</span> a1<span class="token punctuation">,</span> <span class="token keyword">int</span> a2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1 <span class="token operator">&lt;=</span> <span class="token number">64</span> <span class="token operator">||</span> a1 <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">*</span> a2 <span class="token operator">+</span> a1 <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>ç¨‹åºå¯¹è¾“å…¥8å­—èŠ‚æ•°æ®ç»è¿‡32æ¬¡å¾ªç¯å˜æ¢ï¼Œæœ€åå–å‰20ä½ä¸æŒ‡å®šå­—ç¬¦ä¸²æ¯”è¾ƒï¼ŒåŒæ ·åœ°ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªâ€œç©ºé™â€ä½ç½®ï¼Œä¸ºäº†ä¸å½±å“ç»“æœï¼Œè¯¥ä½ç½®è¦åœ¨<code>scanf</code>ä¹‹åï¼Œ</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502145422.png" srcset="/img/loading.gif" alt=""></p>
<p>æˆ‘ä»¬å°†åˆå§‹åŒ–çš„çŠ¶æ€å®šåœ¨<code>scanf</code>æ‰§è¡Œä¹‹åï¼Œ<code>080485FE</code>æ˜¯<code>esp</code>è…¾å‡ºç©ºé—´ç»™4ä¸ª8å­—èŠ‚å˜é‡ï¼Œå› æ­¤ï¼Œé€‰æ‹©<code>080485FE</code>æˆ–è€…<code>08048601</code>ä½œä¸ºèµ·å§‹åœ°å€éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
<p>æ¥ç€å› ä¸ºæˆ‘ä»¬éœ€è¦ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ï¼Œé€šè¿‡åŒå‡»<code>user_input</code>å˜é‡æŸ¥çœ‹è¾“å…¥çš„æ•°å€¼è¢«å­˜å‚¨åˆ°äº†å“ªé‡Œï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502143634.png" srcset="/img/loading.gif" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨<code>bss</code>æ®µä¸­ï¼Œå››ä¸ªå˜é‡é¡ºåºå­˜å‚¨ï¼ˆé—´éš”ä¸º8å­—èŠ‚ï¼‰ï¼Œ<code>user_input</code>èµ·å§‹åœ°å€<code>09FD92A0</code>å°±æ˜¯æˆ‘ä»¬è¦â€œç©ºé™â€çš„ä½ç½®ã€‚<code>angr</code>å…è®¸é€šè¿‡æ“ä½œå†…å­˜ï¼Œæ’å…¥ç¬¦å·å˜é‡ï¼Œä¸»è¦é€šè¿‡<code>memory</code>çš„ä¸¤ä¸ªæ¥å£ï¼ˆå•ä½ä¸º<code>bytes</code>ï¼‰ï¼š</p>
<ul>
<li><code>load(addr,...)</code>: è¯»å–æŒ‡å®šåœ°å€çš„å†…å­˜</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">load</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> condition<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> fallback<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> add_constraints<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> 	      endness<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> inspect<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> disable_actions<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> ret_on_segv<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Loads size bytes from dst.
        :param addr:             The address to load from. 
        :param size:            The size (in bytes) of the load. 
        :param condition:       A claripy expression representing a condition for a conditional load.
        :param fallback:        A fallback value if the condition ends up being False. 
        :param add_constraints: Add constraints resulting from the merge (default: True).
        :param action:          A SimActionData to fill out with the constraints.
        :param endness:         The endness to load with. 
    """</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<ul>
<li><code>store(addr, ...)</code>: å‘æŒ‡å®šå†…å­˜å†™å…¥æ•°æ®</li>
</ul>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">store</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> data<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> condition<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> add_constraints<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> endness<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
              inspect<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> priv<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> disable_actions<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">""</span>"
        Stores content into memory<span class="token punctuation">.</span>
        <span class="token punctuation">:</span>param addr<span class="token punctuation">:</span>        A claripy expression representing the address to store at<span class="token punctuation">.</span> 
        <span class="token punctuation">:</span>param data<span class="token punctuation">:</span>        The data to store <span class="token punctuation">(</span>claripy expression <span class="token keyword">or</span> something convertable to a claripy expression<span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token punctuation">:</span>param size<span class="token punctuation">:</span>        A claripy expression representing the size of the data to store<span class="token punctuation">.</span> <span class="token comment">#å¤§å°</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>ä¸‹é¢æ˜¯å®Œæ•´çš„é¢˜è§£ï¼Œæˆ‘åœ¨å¿…è¦çš„åœ°æ–¹æ·»åŠ äº†æ³¨é‡Šï¼Œå¸®åŠ©ç†è§£</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> sys


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'05_angr_symbolic_memory'</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>

    <span class="token comment"># åˆå§‹åŒ–çŠ¶æ€ä½ç½®ï¼Œåœ¨scanfå‡½æ•°ä¹‹åçš„ä¸¤ä¸ªå‡å¯</span>
    start_address <span class="token operator">=</span> <span class="token number">0x080485FE</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_address<span class="token punctuation">)</span>

    <span class="token comment"># æ³¨æ„è¿™æ¬¡è¾“å…¥çš„æ•°æ®æ˜¯ï¼˜å­—èŠ‚çš„ï¼Œå› æ­¤ç¬¦å·å˜é‡çš„ä½æ•°æ˜¯8*8=64</span>
    passwd_size_in_bits <span class="token operator">=</span> <span class="token number">8</span><span class="token operator">*</span><span class="token number">8</span>
    password0 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password0'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    password1 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password1'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    password2 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password2'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    password3 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password3'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>


    <span class="token comment"># è¦æ³¨å…¥ç¬¦å·å˜é‡çš„ä½ç½®ï¼Œå³è¾“å…¥å˜é‡åœ¨å†…å­˜ä¸­çš„åœ°å€</span>
    password0_address <span class="token operator">=</span> <span class="token number">0x09FD92A0</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>password0_address<span class="token punctuation">,</span> password0<span class="token punctuation">)</span>
    <span class="token comment">#ã€€ç”±äº4ä¸ªå˜é‡æ˜¯è¿ç»­å­˜å‚¨ï¼Œç›´æ¥æŒ‰8å­—èŠ‚å åŠ å³å¯</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>password0_address <span class="token operator">+</span> <span class="token number">0x08</span><span class="token punctuation">,</span> password1<span class="token punctuation">)</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>password0_address <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">,</span> password2<span class="token punctuation">)</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>password0_address <span class="token operator">+</span> <span class="token number">0x18</span><span class="token punctuation">,</span> password3<span class="token punctuation">)</span>

    <span class="token comment"># åé¢ä¸ä¹‹å‰ä¸€æ ·</span>
    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># cast_to=bytes æ˜¯å°†åŸæœ¬8å­—èŠ‚å­˜å‚¨æ•°æ®æŒ‰ç…§bytesæ˜¾ç¤ºï¼Œæœ€ådecodeè½¬æ¢æˆæ™®é€šå­—ç¬¦ä¸²</span>
        solution0 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password0<span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        solution1 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password1<span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        solution2 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password2<span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        solution3 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password3<span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Success, flag is: &#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution0<span class="token punctuation">,</span> solution1<span class="token punctuation">,</span> solution2<span class="token punctuation">,</span> solution3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210502150212.png" srcset="/img/loading.gif" alt=""></p>
<h2 id="06-angr-symbolic-dynamic-memory"><a href="#06-angr-symbolic-dynamic-memory" class="headerlink" title="06_angr_symbolic_dynamic_memory"></a>06_angr_symbolic_dynamic_memory</h2><p>æœ¬é¢˜å’Œä¸Šé¢˜ç›¸ä¼¼ï¼Œåªä¸è¿‡ä¸å†ç”±å †æ ˆåˆ†é…å†…å­˜ï¼Œè€Œæ˜¯<code>molloc</code>åŠ¨æ€åˆ†é…ï¼Œå…ˆçœ‹ä¸‹æºç ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// ebx</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>v4<span class="token punctuation">;</span> <span class="token comment">// ebx</span>
  <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// [esp-10h] [ebp-1Ch]</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-Ch]</span>

  buffer0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">9u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  buffer1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">9u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>buffer0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%8s %8s"</span><span class="token punctuation">,</span> buffer0<span class="token punctuation">,</span> buffer1<span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v3 <span class="token operator">=</span> <span class="token operator">&amp;</span>buffer0<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>v3 <span class="token operator">=</span> <span class="token function">complex_function</span><span class="token punctuation">(</span>buffer0<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v4 <span class="token operator">=</span> <span class="token operator">&amp;</span>buffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>v4 <span class="token operator">=</span> <span class="token function">complex_function</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>buffer0<span class="token punctuation">,</span> <span class="token string">"ZTWVXHOA"</span><span class="token punctuation">,</span> <span class="token number">8u</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">,</span> <span class="token string">"HHPPETFV"</span><span class="token punctuation">,</span> <span class="token number">8u</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Good Job."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>buffer0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">int</span> __cdecl <span class="token function">complex_function</span><span class="token punctuation">(</span><span class="token keyword">signed</span> <span class="token keyword">int</span> a1<span class="token punctuation">,</span> <span class="token keyword">int</span> a2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1 <span class="token operator">&lt;=</span> <span class="token number">64</span> <span class="token operator">||</span> a1 <span class="token operator">></span> <span class="token number">90</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Try again."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">13</span> <span class="token operator">*</span> a2 <span class="token operator">+</span> a1 <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p>ç¨‹åºåŠ¨æ€åˆ›å»ºä¸¤ä¸ª9å­—èŠ‚çš„ç¼“å†²åŒºï¼Œè¾“å…¥ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä»¥8å­—èŠ‚å­˜å‚¨è¾“å…¥ç¼“å†²åŒºï¼Œå¯¹ç¼“å†²åŒºä¸­çš„æ•°æ®è¿›è¡Œ<code>complex_function</code>å˜æ¢ï¼Œå°†å˜æ¢åçš„å­—ç¬¦ä¸²ä¸æŒ‡å®šçš„ä¸¤ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒã€‚</p>
<p>å…ˆç¡®å®šä¸€ä¸‹æˆ‘ä»¬éœ€è¦å¼€å§‹çš„åœ°å€ï¼ˆå³ç©ºé™ä½ç½®ï¼‰ï¼Œæ‰¾åˆ°<code>scanf</code>å‡½æ•°ï¼Œé€‰æ‹©ä¸‹é¢ç¬¬ä¸€ä¸ªæˆ–ç¬¬äºŒä¸ªåœ°å€å³å¯ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210503104737.png" srcset="/img/loading.gif" alt=""></p>
<p>è®°å½•åœ°å€<code>08048696</code>ï¼Œè¿™æ˜¯ä¹‹åçš„<code>start_address</code>ï¼Œç”±äºæˆ‘ä»¬ç›´æ¥ä»è¯¥å¤„æ¨¡æ‹Ÿæ‰§è¡Œï¼Œå› æ­¤å‰é¢çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œå³</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">buffer0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">9u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
buffer1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">9u</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>
<p>ä¸Šé¢æ˜¯<code>molloc</code>å‡½æ•°ä¸º<code>buffer</code>åŠ¨æ€åˆ†é…åœ°å€çš„ä»£ç ï¼Œ ç”±äºä¸è¢«æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åœ°ç»™<code>buffer0,buffer1</code>æŒ‡å‘ä¸€ä¸ªåœ°å€ï¼ˆè™šæ‹Ÿåœ°å€ï¼‰ï¼Œç›¸å½“äºæ¨¡æ‹Ÿäº†<code>molloc</code>çš„æ“ä½œï¼Œæ£€æŸ¥<code>ida</code>ä¸­<code>buffer0, buffer1</code>çš„åœ°å€å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210503105221.png" srcset="/img/loading.gif" alt=""></p>
<p>è¿™ä¸¤ä¸ªåœ°å€æ˜¯<code>buffer0, buffer1</code>æœ¬èº«è¢«å­˜æ”¾çš„å†…å­˜åœ°å€ï¼Œæˆ‘ä»¬éœ€è¦è®©ä»–ä»¬å­˜å‚¨çš„å†…å®¹æ˜¯æˆ‘ä»¬æä¾›çš„è™šæ‹Ÿåœ°å€ï¼Œå¯ä»¥é€šè¿‡<code>memory.store(add,data)</code>çš„æ–¹å¼å¾€è¿™ä¸¤ä¸ªæŒ‡å®šå†…å­˜åœ°å€å†™å…¥æˆ‘ä»¬çš„è™šæ‹Ÿåœ°å€ã€‚</p>
<blockquote>
<p>è¿™éƒ¨åˆ†å¯èƒ½æœ‰ç‚¹æ··ä¹±ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹æ­£å¸¸ç¨‹åºæ‰§è¡Œæ—¶å€™çš„åœ°å€æŒ‡å‘ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">buffer0 <span class="token operator">-></span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>åˆ†é…åœ°å€ <span class="token operator">-></span> string0
buffer1 <span class="token operator">-></span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>åˆ†é…åœ°å€ <span class="token operator">-></span> string1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>
<p>ç”±äºangræ¨¡æ‹Ÿæ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰<code>molloc</code>åˆ†é…çš„ç¯èŠ‚ï¼Œå³ $buffer\to \cancel{malloc} -&gt; string$ ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨<code>buffer</code>çœŸå®å­˜å‚¨çš„ä½ç½®å¡«å†™ä¸€ä¸ª<code>fake_addr</code>(ä»»æ„ï¼Œåªè¦ä¸è¢«ä½¿ç”¨å³å¯)ï¼Œå¹¶è®©å…¶æŒ‡å‘<code>string</code>ç¬¦å·å˜é‡ï¼Œå¦‚ä¸‹</p>
<div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">buffer0 <span class="token operator">-></span> fake_addr <span class="token operator">-></span> string0
buffer1 <span class="token operator">-></span> fake_addr <span class="token operator">-></span> string1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div>
</blockquote>
<p>ä¸‹é¢æ˜¯é¢˜è§£ï¼Œæˆ‘ä¼šåœ¨å¿…è¦åœ°æ–¹æ·»åŠ æ³¨é‡Šï¼Œå¸®åŠ©ç†è§£ï¼š</p>
<div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> claripy
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    path_to_binary <span class="token operator">=</span> <span class="token string">'06_angr_symbolic_dynamic_memeory'</span>
    project <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span>path_to_binary<span class="token punctuation">)</span>

    start_address <span class="token operator">=</span> <span class="token number">0x08048696</span>
    initial_state <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>blank_state<span class="token punctuation">(</span>addr<span class="token operator">=</span>start_address<span class="token punctuation">)</span>

    passwd_size_in_bits <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">8</span>
    password0 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password0'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>
    password1 <span class="token operator">=</span> claripy<span class="token punctuation">.</span>BVS<span class="token punctuation">(</span><span class="token string">'password1'</span><span class="token punctuation">,</span> passwd_size_in_bits<span class="token punctuation">)</span>

    <span class="token comment"># è¿™é‡Œæˆ‘ä»¬æä¾›ä¸€ä¸ªfake_addrï¼ˆä»»æ„ä¸å½±å“ç°æœ‰åœ°å€å³å¯ï¼‰ï¼Œè®©bufferæŒ‡å‘å®ƒï¼Œæ¨¡æ‹Ÿmallocæ“ä½œ</span>
    fake_heap_address0 <span class="token operator">=</span> <span class="token number">0xffffc93c</span>
    pointer_to_malloc_memory_address0 <span class="token operator">=</span> <span class="token number">0x09FD92AC</span>   <span class="token comment"># è¯¥åœ°å€ä¸ºbuffer0çš„åœ°å€</span>
    <span class="token comment">#ã€€angré»˜è®¤å¤§ç«¯ï¼Œå¼€æºç›´æ¥ç”¨project.arch.memory_endness è®¾ç½®å’Œç¨‹åºä¸€æ ·</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>pointer_to_malloc_memory_address0<span class="token punctuation">,</span> fake_heap_address0<span class="token punctuation">,</span> endness<span class="token operator">=</span>project<span class="token punctuation">.</span>arch<span class="token punctuation">.</span>memory_endness<span class="token punctuation">)</span>

    fake_heap_address1 <span class="token operator">=</span> <span class="token number">0xffffc94c</span>
    pointer_to_malloc_memory_address1 <span class="token operator">=</span> <span class="token number">0x09FD92B4</span>  <span class="token comment"># è¯¥åœ°å€ä¸ºbuffer0çš„åœ°å€</span>
    <span class="token comment"># ã€€angré»˜è®¤å¤§ç«¯ï¼Œå¼€æºç›´æ¥ç”¨project.arch.memory_endness è®¾ç½®å’Œç¨‹åºä¸€æ ·</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>pointer_to_malloc_memory_address1<span class="token punctuation">,</span> fake_heap_address1<span class="token punctuation">,</span> endness<span class="token operator">=</span>project<span class="token punctuation">.</span>arch<span class="token punctuation">.</span>memory_endness<span class="token punctuation">)</span>

    <span class="token comment"># å°†æˆ‘ä»¬éœ€è¦çš„ç¬¦å·å˜é‡æ’å…¥åˆ°æˆ‘ä»¬æä¾›çš„fake_addressä¸­ï¼Œè¿™æ ·åœ¨æ‰§è¡Œçš„æ—¶å€™å°±ä¼šè‡ªåŠ¨å°†è¿™éƒ¨åˆ†çš„å˜é‡å–å‡º</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>fake_heap_address0<span class="token punctuation">,</span> password0<span class="token punctuation">)</span>
    initial_state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>store<span class="token punctuation">(</span>fake_heap_address1<span class="token punctuation">,</span> password1<span class="token punctuation">)</span>

    simulation <span class="token operator">=</span> project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>initial_state<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">is_successful</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Good Job.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">should_abort</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">:</span>
        stdout_output <span class="token operator">=</span> state<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span> <span class="token keyword">if</span> <span class="token string">'Try again.'</span> <span class="token keyword">in</span> stdout_output<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

    simulation<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span>is_successful<span class="token punctuation">,</span> avoid<span class="token operator">=</span>should_abort<span class="token punctuation">)</span>

    <span class="token keyword">if</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        solution_state <span class="token operator">=</span> simulation<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># cast_to=bytes æ˜¯å°†åŸæœ¬8å­—èŠ‚å­˜å‚¨æ•°æ®æŒ‰ç…§bytesæ˜¾ç¤ºï¼Œæœ€ådecodeè½¬æ¢æˆæ™®é€šå­—ç¬¦ä¸²</span>
        solution0 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password0<span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        solution1 <span class="token operator">=</span> solution_state<span class="token punctuation">.</span>solver<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span>password1<span class="token punctuation">,</span> cast_to<span class="token operator">=</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Success, flag is: &#123;&#125; &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>solution0<span class="token punctuation">,</span> solution1<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not find the solution'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>
<p><img src="https://cdn.jsdelivr.net/gh/GentleCP/ImgUrl/20210503111134.png" srcset="/img/loading.gif" alt=""></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦æ’°å†™ç»ƒä¹ äº†<code>angr_ctf</code>ä¸­çš„å‰6é“é¢˜ç›®ï¼Œè¿™é‡Œå¯¹ä»–ä»¬åˆ†åˆ«ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>angr_find</strong>ï¼šæœ€ç®€å•çš„æ ¹æ®åœ°å€æŸ¥æ‰¾è·¯å¾„ï¼Œæä¾›ä¸€ä¸ªæƒ³è¦æ‰§è¡Œè·¯å¾„ç›¸å…³çš„åœ°å€ï¼Œè§£æå¾—åˆ°å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹</li>
<li><strong>angr_void</strong>ï¼šåœ¨<code>find</code>çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ä¸å¸Œæœ›æ‰§è¡Œçš„è·¯å¾„ä¿¡æ¯ï¼ˆè¯¥è·¯å¾„ä¸Šä¸€ä¸ªç›¸å…³åœ°å€ï¼‰ï¼Œåœ¨å¤§å‹ç¨‹åºä¸­èƒ½å¤Ÿå¤§å¤§æé«˜æ‰§è¡Œæ•ˆç‡</li>
<li><strong>angr_find_condition</strong>: æŒ‰ç…§æ¡ä»¶æ‰§è¡Œè·¯å¾„ï¼Œå¦‚éœ€è¦åˆ†æ”¯è¾“å‡ºç‰¹å®šçš„ç»“æœæ‰å»æ‰§è¡Œï¼Œè¿™é¿å…äº†æ‰¾ä¸€å †æ‰§è¡Œè·¯å¾„ç›¸å…³åœ°å€çš„éº»çƒ¦</li>
<li><strong>angr_symbolic_registers</strong>: å°†angrç¬¦å·å˜é‡ç›´æ¥å†™å…¥å¯„å­˜å™¨ä¸­ï¼Œæ­¤æ—¶ä¸å†éœ€è¦ä»ç¨‹åºå…¥å£ç‚¹<code>main</code>è¿›å…¥ï¼Œå¯ä»¥è·³è¿‡è®¸å¤šä¸ç›¸å…³çš„ä»£ç ï¼Œåé¢çš„å‡ é¢˜åŸºæœ¬ä¹Ÿæ˜¯å›´ç»•è¾“å…¥æ•°æ®å­˜å‚¨åœ¨å“ªï¼Œå¦‚ä½•ç›´æ¥â€œç©ºé™â€åˆ°æŒ‡å®šä½ç½®ï¼Œå¹¶è®©ç¨‹åºæ­£å¸¸æ¨¡æ‹Ÿæ‰§è¡Œã€‚</li>
<li><strong>angr_symbolic_stack</strong>: è¾“å…¥ç»“æœä¸å†ä¿å­˜åˆ°å¯„å­˜å™¨ï¼Œè€Œæ˜¯å­˜å‚¨åˆ°æ ˆä¸­ï¼Œéœ€è¦æ·»åŠ å¯¹æ ˆçš„æ“ä½œï¼Œæ‰‹åŠ¨å°†ç¬¦å·å˜é‡å‹å…¥æ ˆ</li>
<li><strong>angr_symbolic_memory</strong>: ç›´æ¥ä¿®æ”¹å†…å­˜ä¸­ä¿å­˜çš„å†…å®¹ï¼Œå­¦ä¹ <code>memory.store()</code>çš„ä½¿ç”¨</li>
<li><strong>angr_symbolic_dynamic_memory</strong>: æ¨¡æ‹Ÿ<code>malloc</code>åŠ¨æ€åˆ†é…å†…å­˜åœ°å€ï¼Œæä¾›<code>fake_address</code></li>
</ul>
<section class="footnotes"><h2>å‚è€ƒ</h2><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://github.com/ZERO-A-ONE/AngrCTF_FITM/blob/master/ç¬”è®°/01/Angr_CTFä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸€ï¼‰.md">AngrCTF_FITM/Angr_CTFä»å…¥é—¨åˆ°ç²¾é€šï¼ˆä¸€ï¼‰.md at master Â· ZERO-A-ONE/AngrCTF_FITM (github.com)</a>
<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://github.com/lcatro/Angr-CTF-Learn-Note">lcatro/Angr-CTF-Learn-Note: The learn note of Angr-CTF .. (github.com)</a>
<a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf">jakespringer/angr_ctf (github.com)</a>
<a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/security/">security</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/binary/">binary</a>
                    
                      <a class="hover-with-bg" href="/tags/symbolic-execution/">symbolic_execution</a>
                    
                      <a class="hover-with-bg" href="/tags/static-analysis/">static_analysis</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/article/22468.html">
                        <span class="hidden-mobile">ã€corpwechat-botã€‘ä¸€ä¸ªå¥½ç”¨çš„ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯æ¨é€pythonæ¥å£åº“</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'GentleCP/blog.gentlecp.com');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://www.gentlecp.com" target="_blank" rel="nofollow noopener"><span>ä¸»ç«™</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/GentleCP/blog.gentlecp.com" target="_blank" rel="nofollow noopener"><span>Repo</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


  
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        äº¬ICPè¯123456å·
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon"/>
            
            <span>æµ™ICPå¤‡19022407å·-1</span>
          </a>
        </span>
      
    
  </div>


  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  
    
  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-svg.js" ></script>

  










  
<script src="/js/baidu.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
